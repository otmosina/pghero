<div class="content">
  <h1>Explain</h1>

  <%= form_tag explain_path do %>
    <div class="field"><%= text_area_tag :query, @query, placeholder: "Enter a SQL query" %></div>
    <p>
      <%= submit_tag "Explain", class: "btn btn-info", style: "margin-right: 10px;" %>
      <%= submit_tag "Analyze", class: "btn btn-danger", style: "margin-right: 10px;" %>
      <%= submit_tag "Visualize", class: "btn btn-danger" %>
    </p>
  <% end %>

  <% if @explanation %>
    <% if @visualize %>
      <p>Paste the output below into the <%= link_to "Postgres Explain Visualizer", "https://tatiyants.com/pev/#/plans/new", target: "_blank" %></p>
    <% end %>
    <pre>
    <!--
      <svg aria-hidden="false" viewBox="0 0 16 16" version="1.1" data-view-component="true" height="16" width="16" class="octicon octicon-clippy js-clipboard-clippy-icon m-2" style="float: right;cursor: pointer;">
    -->      
    <style>
      #copy_svg {
        float: right;
        cursor: pointer;
      }
    </style>
    <!-- JS Example for copy to buffer-->
    <script>
      //https://stackoverflow.com/questions/400212/how-do-i-copy-to-the-clipboard-in-javascript
    </script>
    <svg id="copy_svg" height="16" width="16">
      <path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path>
    </svg>
    <code><%= @explanation %></code></pre>
    <% unless @visualize %>
      <p><%= link_to "See how to interpret this", "https://www.postgresql.org/docs/current/static/using-explain.html", target: "_blank" %></p>
    <% end %>
    <% if (index = @suggested_index) %>
      <%= render partial: "suggested_index", locals: {index: index, details: index[:details]} %>
    <% end %>
  <% elsif @error %>
    <div class="alert alert-danger"><%= @error %></div>
  <% end %>
</div>
